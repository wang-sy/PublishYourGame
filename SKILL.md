---
name: game-publish-api
description: Use when users need to publish web games to the GameAI Publisher service through platform APIs. Covers both /api/upload (zip upload) and /api/publish (JSON file list), with multi-client recipes (Python, curl, Node.js, PowerShell) so users on different platforms can run immediately.
---

# Game Publish API Skill

Use this skill when the user wants to publish a web game to GameAI Publisher using platform APIs, or needs a reliable publish script that runs on macOS/Linux/Windows.

## What this skill covers

- End-to-end publish through `POST /api/upload` (zip package).
- End-to-end publish through `POST /api/publish` (JSON files payload).
- Multi-client execution:
  - Python CLI: `scripts/publish_game.py`
  - Node.js CLI: `scripts/publish_game_node.mjs`
  - direct `curl` commands
  - PowerShell-native commands
- Fast verification of publish result (`game.id`, `gameUrl`).

## Required inputs

- `base_url`: GameAI Publisher host, for example `http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000`.
- `title`: Game title.
- One publish source:
  - `zip` file for `/api/upload`, or
  - project directory containing `index.html` for `/api/publish`.

Optional:

- `description`
- `x-request-id`
- extra headers (`Authorization`, tenant headers, etc.)

## Endpoint choice

- Choose `/api/upload` when user already has a zip package.
- Choose `/api/publish` when user has an extracted project directory and wants direct file publishing.

## Default workflow

1. Validate input shape:
- zip mode: file exists and ends with `.zip`.
- file mode: directory exists and contains `index.html`.

2. Choose client and run:
- Python available: use `scripts/publish_game.py`.
- Node.js available but no Python: use `scripts/publish_game_node.mjs`.
- User asks explicitly for `curl`: use curl recipes for `/api/upload` and `/api/publish`.
- Windows-only ops users: prefer PowerShell recipe (or `curl.exe`).

3. Parse response:
- Success: `success=true`, `data.id`, `data.gameUrl`.
- Failure: `success=false` and `error`.

4. Return a concise publish result summary to user:
- endpoint used
- game id
- game url
- request id (if available)

## Quick command examples

macOS/Linux:

```bash
python3 scripts/publish_game.py upload-zip \
  --base-url http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000 \
  --zip ./my_game.zip \
  --title "My Game" \
  --description "Generated by AI"
```

Windows PowerShell:

```powershell
py -3 scripts\\publish_game.py upload-zip `
  --base-url http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000 `
  --zip .\\my_game.zip `
  --title "My Game" `
  --description "Generated by AI"
```

Publish directory with `/api/publish`:

```bash
python3 scripts/publish_game.py publish-files \
  --base-url http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000 \
  --dir ./my_game_project \
  --title "My Game" \
  --description "Direct publish"
```

curl upload zip:

```bash
curl -sS -X POST "http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000/api/upload" \
  -F "title=My Game" \
  -F "description=Generated by AI" \
  -F "file=@./my_game.zip;type=application/zip"
```

Node.js CLI upload zip:

```bash
node scripts/publish_game_node.mjs upload-zip \
  --base-url http://nlb-8rcqh9faj37iiwegkc.ap-southeast-1.nlb.aliyuncsslbintl.com:3000 \
  --zip ./my_game.zip \
  --title "My Game"
```

## Script notes

- Python and Node CLIs both have no third-party dependency.
- `publish-files` encodes file content as Base64 by default to support binary assets safely.
- Text files can be sent as UTF-8 string with `--prefer-text`.

## Validation and troubleshooting

- If API returns `index.html not found in zip` or `index.html is required as entry point`, verify package root and entry file name.
- If API returns `Only zip files are supported`, switch to `publish-files` or pass a `.zip`.
- If API returns `Failed to publish game`/`Failed to upload game`, check server logs with `x-request-id`.

For full request/response contracts and constraints, load:
`references/api-contract.md`

For multi-client command recipes (curl/PowerShell/Node/Python), load:
`references/client-recipes.md`
